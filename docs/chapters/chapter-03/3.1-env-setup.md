# 3.1 å¼€å‘ç¯å¢ƒå‡†å¤‡

> æœ¬èŠ‚æˆ‘ä»¬å°†æ­å»º MiniClaw çš„å¼€å‘ç¯å¢ƒï¼Œåˆ›å»ºä¸€ä¸ªå¯è¿è¡Œçš„ Spring Boot é¡¹ç›®ã€‚

## ğŸ“‹ æœ¬èŠ‚ç›®æ ‡

- å®‰è£… JDK 21ï¼ˆSpring Boot 3.4.5 æ”¯æŒçš„æœ€ä½ç‰ˆæœ¬ï¼‰
- å®‰è£… Maven 3.8+
- åˆ›å»º Spring Boot é¡¹ç›®
- éªŒè¯é¡¹ç›®èƒ½æ­£å¸¸ç¼–è¯‘

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. ä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

MiniClaw æä¾›äº†è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼Œæ”¯æŒ Ubuntu/Debian/CentOS/Rocky ç­‰ä¸»æµ Linux å‘è¡Œç‰ˆï¼š

```bash
cd miniclaw-learn
bash scripts/install-env.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**
- æ£€æµ‹æ“ä½œç³»ç»Ÿ
- å®‰è£… JDK 21
- å®‰è£… Maven 3.9
- éªŒè¯ç¯å¢ƒ

**å®‰è£…å®Œæˆåçš„è¾“å‡ºï¼š**

```
âœ“ JDK 21 å®‰è£…æˆåŠŸ
openjdk version "21.0.9-ga" 2025-10-21
OpenJDK Runtime Environment TencentKonaJDK (build 21.0.9-ga+1)

âœ“ Maven 3.9.9 å®‰è£…æˆåŠŸ
Apache Maven 3.9.9
```

### 2. æ‰‹åŠ¨å®‰è£…ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ çš„ç³»ç»Ÿä¸åœ¨æ”¯æŒåˆ—è¡¨ä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼š

#### JDK 21 å®‰è£…

**æ£€æŸ¥æ˜¯å¦å·²å®‰è£…ï¼š**

```bash
java -version
```

**é¢„æœŸè¾“å‡ºï¼š**

```
java version "21.0.9" 2025-10-21
```

**å®‰è£…æ–¹æ³•ï¼š**

- **macOS**: `brew install openjdk@21`
- **Ubuntu/Debian**: `sudo apt install openjdk-21-jdk`
- **Windows**: ä¸‹è½½ [Oracle JDK 21](https://www.oracle.com/java/technologies/downloads/)

#### Maven 3.8+ å®‰è£…

**æ£€æŸ¥æ˜¯å¦å·²å®‰è£…ï¼š**

```bash
mvn -version
```

**é¢„æœŸè¾“å‡ºï¼š**

```
Apache Maven 3.8.6
Java version: 21.0.9
```

**å®‰è£…æ–¹æ³•ï¼š**

- **macOS**: `brew install maven`
- **Ubuntu/Debian**: `sudo apt install maven`
- **Windows**: ä¸‹è½½ [Maven](https://maven.apache.org/download.cgi)

### 3. IDE å®‰è£…

æ¨èä½¿ç”¨ **IntelliJ IDEA**ï¼ˆç¤¾åŒºç‰ˆæˆ–æ——èˆ°ç‰ˆå‡å¯ï¼‰ã€‚

- ä¸‹è½½åœ°å€ï¼šhttps://www.jetbrains.com/idea/download/

**IDEA æ¨èæ’ä»¶ï¼š**

- Lombok Pluginï¼ˆå¿…é¡»ï¼‰
- Spring Boot Assistant
- Maven Helper

## ğŸ“¦ é¡¹ç›®ç»“æ„

æœ¬èŠ‚åˆ›å»ºçš„é¡¹ç›®ç»“æ„ï¼š

```
miniclaw-learn/
â”œâ”€â”€ pom.xml                                    # Maven é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/miniclaw/
â”‚   â”‚   â”‚   â””â”€â”€ MiniClawApplication.java       # ä¸»å¯åŠ¨ç±»
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.yml                # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/miniclaw/
â”‚           â””â”€â”€ MiniClawApplicationTests.java  # æµ‹è¯•ç±»
â””â”€â”€ .gitignore
```

## ğŸ“„ æ ¸å¿ƒæ–‡ä»¶è§£æ

### pom.xml

Maven é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®çš„ä¾èµ–å’Œæ„å»ºæ–¹å¼ã€‚

**å…³é”®é…ç½®ï¼š**

```xml
<!-- Spring Boot ç‰ˆæœ¬ -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.4.5</version>
</parent>

<!-- JDK ç‰ˆæœ¬ -->
<properties>
    <maven.compiler.source>24</maven.compiler.source>
    <maven.compiler.target>24</maven.compiler.target>
</properties>
```

**æ ¸å¿ƒä¾èµ–è¯´æ˜ï¼š**

| ä¾èµ– | ç”¨é€” | ä½•æ—¶ä½¿ç”¨ |
|------|------|----------|
| `spring-boot-starter-webflux` | å“åº”å¼ Web æ¡†æ¶ | ç¬¬ 4-5 ç« ï¼ˆLLM æµå¼è¾“å‡ºã€WebSocketï¼‰ |
| `spring-boot-starter-data-jpa` | æ•°æ®è®¿é—®å±‚ | ç¬¬ 3 ç« ï¼ˆSession/Run/Message å®ä½“ï¼‰ |
| `postgresql` | PostgreSQL é©±åŠ¨ | ç¬¬ 3 ç« ï¼ˆæ•°æ®åº“è¿æ¥ï¼‰ |
| `flyway-core` | æ•°æ®åº“è¿ç§» | ç¬¬ 3 ç« ï¼ˆç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“ï¼‰ |
| `lombok` | ç®€åŒ– Java ä»£ç  | å…¨ç¨‹ä½¿ç”¨ |
| `spring-boot-starter-actuator` | å¥åº·æ£€æŸ¥ | ç¬¬ 15 ç« ï¼ˆç”Ÿäº§éƒ¨ç½²ï¼‰ |
| `spring-boot-starter-validation` | å‚æ•°æ ¡éªŒ | ç¬¬ 7 ç« ï¼ˆå·¥å…·è°ƒç”¨æ ¡éªŒï¼‰ |

### MiniClawApplication.java

Spring Boot ä¸»å¯åŠ¨ç±»ã€‚

**å…³é”®æ³¨è§£ï¼š**

```java
@SpringBootApplication  // å¯ç”¨ Spring Boot è‡ªåŠ¨é…ç½®
public class MiniClawApplication {
    public static void main(String[] args) {
        SpringApplication.run(MiniClawApplication.class, args);
    }
}
```

### application.yml

Spring Boot é…ç½®æ–‡ä»¶ã€‚

**å½“å‰é…ç½®ï¼š**

```yaml
spring:
  application:
    name: miniclaw-learn

  # JPA é…ç½®ï¼ˆæš‚æ—¶ç¦ç”¨ï¼Œ3.3 èŠ‚å¯ç”¨ï¼‰
  jpa:
    hibernate:
      ddl-auto: none  # ç¦ç”¨è‡ªåŠ¨å»ºè¡¨ï¼Œä½¿ç”¨ Flyway
    show-sql: false

  # Flyway é…ç½®ï¼ˆæš‚æ—¶ç¦ç”¨ï¼Œ3.3 èŠ‚å¯ç”¨ï¼‰
  flyway:
    enabled: false

server:
  port: 8080

logging:
  level:
    com.miniclaw: DEBUG  # å¼€å‘ç¯å¢ƒå¼€å¯ DEBUG æ—¥å¿—
```

**æ³¨æ„ï¼š** `ddl-auto: none` è¡¨ç¤ºç¦ç”¨ Hibernate çš„è‡ªåŠ¨å»ºè¡¨åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Flyway ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬ï¼ˆ3.3 èŠ‚ï¼‰ã€‚

## âœ… éªŒè¯å®‰è£…

### 1. éªŒè¯ç¯å¢ƒ

```bash
# æ£€æŸ¥ Java ç‰ˆæœ¬
java -version

# æ£€æŸ¥ Maven ç‰ˆæœ¬
mvn -version
```

**é¢„æœŸè¾“å‡ºï¼š**

```
openjdk version "21.0.9-ga" 2025-10-21
Apache Maven 3.8.6
Java version: 21.0.9
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
cd miniclaw-learn
mvn clean compile -DskipTests
```

**é¢„æœŸè¾“å‡ºï¼š**

```
[INFO] BUILD SUCCESS
[INFO] Total time: 18.454 s
```

### 3. å¯¼å…¥ IDEA

1. æ‰“å¼€ IDEA
2. `File` â†’ `Open`
3. é€‰æ‹© `miniclaw-learn` ç›®å½•
4. ç­‰å¾… Maven è‡ªåŠ¨ä¸‹è½½ä¾èµ–

### 4. è¿è¡Œåº”ç”¨

**æ–¹æ³• 1ï¼šå‘½ä»¤è¡Œ**

```bash
mvn spring-boot:run
```

**æ–¹æ³• 2ï¼šIDEA**

1. æ‰“å¼€ `MiniClawApplication.java`
2. ç‚¹å‡» `main` æ–¹æ³•æ—çš„ç»¿è‰²è¿è¡ŒæŒ‰é’®
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

**é¢„æœŸè¾“å‡ºï¼š**

```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.4.5)

Started MiniClawApplication in 2.345 seconds
```

### 5. è¿è¡Œå•å…ƒæµ‹è¯•

```bash
mvn test
```

**é¢„æœŸè¾“å‡ºï¼š**

```
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
BUILD SUCCESS
```

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### ä¸ºä»€ä¹ˆç”¨ WebFlux è€Œä¸æ˜¯ Webï¼Ÿ

MiniClaw é€‰æ‹© **WebFlux**ï¼ˆå“åº”å¼ï¼‰è€Œä¸æ˜¯ä¼ ç»Ÿçš„ **Spring MVC**ï¼ŒåŸå› ï¼š

1. **LLM æµå¼è¾“å‡º**ï¼šAI å¯¹è¯éœ€è¦é€å­—æ˜¾ç¤ºï¼ŒWebFlux åŸç”Ÿæ”¯æŒæµå¼å“åº”
2. **é«˜å¹¶å‘**ï¼šå“åº”å¼ç¼–ç¨‹æ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯
3. **èƒŒå‹å¤„ç†**ï¼šå¯ä»¥æ§åˆ¶æ•°æ®æµé€Ÿç‡ï¼Œé¿å…å†…å­˜æº¢å‡º

**ç¬¬ 4 ç« ** ä¼šæ·±å…¥è®²è§£ WebFlux çš„ä½¿ç”¨ã€‚

### ä¸ºä»€ä¹ˆç”¨ JDK 21ï¼Ÿ

- **è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰**ï¼šJDK 21 å¼•å…¥ï¼Œå¤§å¹…æå‡å¹¶å‘æ€§èƒ½
- **Spring Boot 3.4.5 æ”¯æŒ**ï¼š21 æ˜¯æœ€ä½æ”¯æŒç‰ˆæœ¬
- **é•¿æœŸæ”¯æŒ**ï¼šJDK 21 æ˜¯ LTS ç‰ˆæœ¬ï¼Œç¨³å®šæ€§æœ‰ä¿éšœ
- **å¹¿æ³›å…¼å®¹**ï¼šä¸»æµäº‘å‚å•†å’Œ Docker é•œåƒéƒ½æ”¯æŒ

### Spring Boot 3.x çš„æ–°ç‰¹æ€§

1. **Jakarta EE 9+**ï¼š`javax.*` â†’ `jakarta.*`
2. **åŸç”Ÿç¼–è¯‘**ï¼šæ”¯æŒ GraalVM åŸç”Ÿé•œåƒ
3. **å¯è§‚æµ‹æ€§**ï¼šå†…ç½® Micrometer æ”¯æŒ

## ğŸ› å¸¸è§é—®é¢˜

### 1. Maven ä¾èµ–ä¸‹è½½å¤±è´¥

**é—®é¢˜ï¼š**

```
Could not transfer artifact org.springframework.boot:spring-boot-starter-parent:pom:3.4.5
```

**è§£å†³æ–¹æ¡ˆï¼š**

é…ç½® Maven é•œåƒï¼ˆé˜¿é‡Œäº‘ï¼‰ï¼š

```xml
<!-- åœ¨ ~/.m2/settings.xml ä¸­æ·»åŠ  -->
<mirror>
    <id>aliyun</id>
    <mirrorOf>central</mirrorOf>
    <name>Aliyun Maven</name>
    <url>https://maven.aliyun.com/repository/public</url>
</mirror>
```

### 2. Lombok ä¸ç”Ÿæ•ˆ

**é—®é¢˜ï¼š** IDEA æç¤ºæ‰¾ä¸åˆ° getter/setter æ–¹æ³•ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

1. å®‰è£… **Lombok Plugin** æ’ä»¶
2. `Settings` â†’ `Build, Execution, Deployment` â†’ `Compiler` â†’ `Annotation Processors`
3. å‹¾é€‰ `Enable annotation processing`

### 3. ç«¯å£è¢«å ç”¨

**é—®é¢˜ï¼š**

```
Web server failed to start. Port 8080 was already in use.
```

**è§£å†³æ–¹æ¡ˆï¼š**

ä¿®æ”¹ `application.yml`ï¼š

```yaml
server:
  port: 8081  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

æˆ–ç»ˆæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š

```bash
# macOS/Linux
lsof -i :8080
kill -9 <PID>

# Windows
netstat -ano | findstr :8080
taskkill /F /PID <PID>
```

## ğŸ“š æ‰©å±•é˜…è¯»

- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-boot/docs/3.4.5/reference/html/)
- [Spring WebFlux å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-framework/docs/6.2.0/reference/html/web-reactive.html)
- [Maven å®˜æ–¹æ–‡æ¡£](https://maven.apache.org/guides/)

## ğŸ¯ ä¸‹ä¸€æ­¥

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ï¼š
- ä½¿ç”¨ Docker Compose ç¼–æ’ PostgreSQL æ•°æ®åº“
- å®‰è£… pgvector æ‰©å±•ï¼ˆå‘é‡æ£€ç´¢æ”¯æŒï¼‰
- é…ç½®æ•°æ®åº“è¿æ¥æ± 

[ä¸‹ä¸€èŠ‚ï¼š3.2 Docker Compose ç¼–æ’åŸºç¡€è®¾æ–½ â†’](./3.2-docker-compose.md)
